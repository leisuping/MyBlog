---
title : ä¸€å®šè¦æ‡‚çš„jsåŸºç¡€ï¼Œä½ ä¼šäº†å—ï¼Ÿ
date: 2021-12-07 17:03:20
img: https://s2.232232.xyz/static/384/2022/12/08-639182ccac162.jpeg
tags:
 - å‰ç«¯
 - äº‹ä»¶å¾ªç¯
categories: 
 - å‰ç«¯
 - js
keywords:
 - äº‹ä»¶å¾ªç¯ã€å¼‚æ­¥è§£å†³æ–¹æ¡ˆ
 - ä¸€å®šè¦æ‡‚çš„jsåŸºç¡€ï¼Œä½ ä¼šäº†å—ï¼Ÿ
---
## ä¸€ã€EventLoopäº‹ä»¶å¾ªç¯
> ğŸ¯ jsæ˜¯ä¸€ä¸ªå•çº¿ç¨‹è„šæœ¬è¯­è¨€ã€‚
> åœ¨æ‰§è¡Œæ¯”è¾ƒè€—æ—¶çš„ä»»åŠ¡æ—¶å¾ˆå®¹æ˜“å¯¼è‡´çº¿ç¨‹é˜»å¡ï¼Œå¯¼è‡´é¡µé¢å¡é¡¿çš„æƒ…å†µã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å°±æœ‰äº† eventLoop äº‹ä»¶å¾ªç¯ã€‚
> eventLoop å°†jsçº¿ç¨‹ä¸­çš„ä»»åŠ¡åˆ†ä¸ºï¼šå®ä»»åŠ¡ã€å¾®ä»»åŠ¡ã€‚
> åœ¨ä»»åŠ¡è¿›å…¥æ‰§è¡Œæ ˆåï¼Œä¼šå…ˆåˆ¤æ–­æ˜¯å¦ä¸ºå®ä»»åŠ¡ï¼Œå®ä»»åŠ¡è¿›å…¥ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå¾®ä»»åŠ¡è¿›å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ç­‰å¾…æ‰§è¡Œã€‚
> å®ä»»åŠ¡æ‰§è¡Œç»“æŸï¼ˆå°±å·²ç»ç¡®ä¿å®ä»»åŠ¡æ ˆç©ºäº†ï¼‰å†åˆ¤æ–­å¾®ä»»åŠ¡æ ˆæ˜¯å¦æœ‰å¾®ä»»åŠ¡éœ€è¦æ‰§è¡Œã€‚

![](./stack.png)

### 1.å®ä»»åŠ¡macro-taskã€å¾®ä»»åŠ¡micro-task
1. å®ä»»åŠ¡ï¼šjsæ•´ä½“ä»£ç ã€setTimeoutã€setInterval ... ...
2. å¾®ä»»åŠ¡ï¼špromise ... ...ï¼ˆå›è°ƒã€éœ€è¦è€—æ—¶çš„ï¼‰
è¡¥å……ï¼šè™½ç„¶ setTimeout æ˜¯å®ä»»åŠ¡ä½†æ˜¯å®ƒçš„å›è°ƒä¼šè¢«æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚
è™½ç„¶ promise æ˜¯å¾®ä»»åŠ¡ï¼Œä½†æ˜¯new Promiseä¼šç«‹å³æ‰§è¡Œï¼Œå›è°ƒä¼šæ”¾å…¥å¾®ä»»åŠ¡æ ˆä¸­ã€‚

![](./task.png)
![](./evenloop.png)


## äºŒã€Promiseå¼‚æ­¥è§£å†³æ–¹æ¡ˆ
> ğŸ¯ Promiseæ˜¯jsä¸­çš„ä¸€ç§å¼‚æ­¥è§£å†³æ–¹æ¡ˆã€‚
> æ”¯æŒé“¾å¼è°ƒç”¨ .then() .catch() .finally()ï¼Œè§£å†³äº†ä¼ ç»Ÿå¼‚æ­¥è§£å†³æ–¹æ¡ˆï¼ˆajaxï¼‰å›è°ƒåœ°ç‹±çš„é—®é¢˜ã€‚ï¼ˆç¼ºç‚¹ï¼šæ‰€æœ‰çš„é”™è¯¯/å¼‚å¸¸éœ€è¦åœ¨å›è°ƒå‡½æ•°catchä¸­æ•è·å¤„ç†ï¼‰
> promiseå‡½æ•°è‡ªå¸¦ä¸¤ä¸ªå‚æ•°resolveã€rejectï¼Œå¼‚æ­¥è¯·æ±‚æˆåŠŸæ‰§è¡Œresolveï¼Œå¤±è´¥æ‰§è¡Œrejectã€‚

### 1.promiseä¸‰ç§çŠ¶æ€ï¼ˆçŠ¶æ€å‘ç”Ÿå˜åŒ–åä¸å¯é€†ï¼‰
â— Pending åˆå§‹çŠ¶æ€ï¼Œè¿›è¡Œä¸­
â— Resolvedï¼ˆfulfilledï¼‰ å·²å®Œæˆï¼ŒæˆåŠŸ
â— Rejected å·²å¤±è´¥

### 2.promiseé“¾
promiseçš„æ¯ä¸€ä¸ªé“¾å¼è°ƒç”¨éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„promiseå¯¹è±¡ï¼Œåˆå¯ä»¥æ¥ç€ä½¿ç”¨.then() .catch() ç”±æ­¤å½¢æˆpromiseé“¾ã€‚åœ¨ then ä¸­ä½¿ç”¨äº†returnï¼Œé‚£ä¹ˆreturnçš„å€¼ä¼šè¢«promise.resolve() åŒ…è£…ã€‚

![](./promise1.png)

### 3.promise.all()ä¸promise.race()
1. promise.all() å¹¶å‘æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œæ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæˆæ‰è¿›å…¥å›è°ƒã€‚
2. promise.race() åªè¦æœ‰ä¸€ä¸ªä»»åŠ¡å®Œæˆï¼Œå°±æ‰§è¡Œå›è°ƒå¾—åˆ°ç»“æœã€‚
è¡¥å……ï¼š
then() å¾—åˆ°å¼‚æ­¥æˆåŠŸçš„ä¿¡æ¯ï¼Œè¿”å›promiseå¯¹è±¡å¯ä»¥ç»§ç»­è°ƒç”¨ä¸‹ä¸€ä¸ªthen()
catch() å¾—åˆ°å¼‚æ­¥å¤±è´¥çš„ä¿¡æ¯ï¼Œè¿”å›promiseå¯¹è±¡å¯ä»¥ç»§ç»­è°ƒç”¨ä¸‹ä¸€ä¸ªthen()
finally() æ— è®ºæˆåŠŸå¤±è´¥éƒ½æ‰§è¡Œï¼Œè¿”å›promiseå¯¹è±¡å¯ä»¥ç»§ç»­è°ƒç”¨ä¸‹ä¸€ä¸ªthen()


è¡¥å……ï¼šå…³äºå®ä»»åŠ¡ã€å¾®ä»»åŠ¡æ‰§è¡Œé¡ºåº
![](./promise.png)

æ‰§è¡Œé¡ºåº
1ã€jsä»£ç ã€new Promiseå†…å®¹ï¼ˆpromiseæ„é€ å†…çš„ä»£ç æ˜¯ç«‹å³æ‰§è¡Œçš„ï¼‰
2ã€new Promise å›è°ƒï¼ˆthenå‡½æ•°åœ¨promise.resolve()åæ‰§è¡Œï¼‰
3ã€setTimeout å›è°ƒ
4ã€new Promise é‡Œé¢çš„setTimeout å›è°ƒ

new Promise ä¼šç«‹å³æ‰§è¡Œï¼Œthen()ã€catch()ã€finally()ç­‰å›è°ƒä¼šè¢«æ”¾åœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­åæ‰§è¡Œã€‚ï¼ˆä¼šå…ˆäºsetTimeoutçš„å›è°ƒï¼‰


## ä¸‰ã€Asyncã€Await
> ğŸ¯ async/await ä¹Ÿæ˜¯jsä¸­å¼‚æ­¥çš„è§£å†³æ–¹æ¡ˆï¼Œæ›´è¿›ä¸€æ­¥ä¼˜åŒ–äº†å¼‚æ­¥ä»£ç å—ã€‚
> å…¶åŸç†å°±æ˜¯generator åŠ ä¸Šäº†promiseè¯­æ³•ç³–ï¼Œå†…éƒ¨å®ç°äº†è‡ªåŠ¨æ‰§è¡Œgeneratorã€‚

### 1.Asyncã€Awaitçš„ç‰¹ç‚¹
asyncè¿”å›çš„æ˜¯ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œè€Œawaitå°±æ˜¯ç­‰promiseçš„ç»“æœè¿”å›åå†æ‰§è¡Œã€‚ï¼ˆawaitæ¥æ”¶çš„å°±æ˜¯promiseè¿”å›çš„ç»“æœï¼Œåé¢ä¸ä¸€å®šè¦ä½¿ç”¨.thenï¼‰
async æ ‡è®°å½“å‰ä»£ç å—ä¸ºå¼‚æ­¥ï¼Œawaitåˆ™æ˜¯å°†å¼‚æ­¥å˜ä¸ºåŒæ­¥ï¼ˆ.thençš„è¯­æ³•ç³–ï¼Œè¿”å›promiseå¯¹è±¡ï¼‰

awaitåªèƒ½åœ¨asyncå‡½æ•°ä¸­ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨ã€‚

ä¼˜ç‚¹ï¼š
1ã€ç®€æ´æ˜äº†
2ã€å¯ä»¥ç»“åˆpromiseè¿›è¡Œå¼‚æ­¥çš„å¤„ç†

```js
// Tip1
async function test() {
    const { data } = await axios.post('api/v3/batchadd', objarray);
    const { data2 } = await axios.post('api/v3/batchadd2', objarray2);
    // è¿™é‡Œä¹Ÿå¯ä»¥åšä¸€äº›åˆ«çš„å¤„ç†
    return data.concat(data2);
}
test().then(res => {
// å…¶ä»–çš„é€»è¾‘å¤„ç†
}).catch((error) => {
// å¤„ç†å¼‚å¸¸
});

// Tip2
// ä¹Ÿå¯ä»¥åœ¨asyncä¸­ä½¿ç”¨try catchæ¥å¤„ç†å¼‚å¸¸
async function test() {
    try {
        const { data } = await axios.post('api/v3/batchadd', objarray);
        const { data2 } = await axios.post('api/v3/batchadd2', objarray2);
        // è¿™é‡Œä¹Ÿå¯ä»¥åšä¸€äº›åˆ«çš„å¤„ç†
        return data.concat(data2);
    }catch(err) {
    // å¤„ç†å¼‚å¸¸
    }
}

// ä¹Ÿå¯ä»¥ç”¨promise.race(test1, test2);å®ç°ã€‚ï¼ˆå¹¶å‘æ‰§è¡Œå¯ä»¥ä½¿ç”¨promise.all() æ¥å®ç°ï¼‰
```



